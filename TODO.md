# TODO

- [x] Test and implement all documented 6502 instructions
  - [x] Implement CPU state and initialization
  - [x] Implement fetch-decode-execute cycle
  - [x] Implement addressing modes
    - [x] Immediate
    - [x] Zero Page
    - [x] Zero Page,X
    - [x] Zero Page,Y
    - [x] Absolute
    - [x] Absolute,X
    - [x] Absolute,Y
    - [x] Indirect
    - [x] Indexed Indirect (X,Indirect)
    - [x] Indirect Indexed (Indirect,Y)
  - [x] Implement status register flags
  - [x] Implement groups of instructions:
    - [x] Load/Store operations (LDA, LDX, LDY, STA, STX, STY)
    - [x] Register transfers (TAX, TAY, TXA, TYA, TSX, TXS)
    - [x] Stack operations (PHA, PHP, PLA, PLP)
    - [x] Logical operations (AND, EOR, ORA, BIT)
    - [x] Arithmetic operations (ADC, SBC, CMP, CPX, CPY)
    - [x] Increments/Decrements (INC, INX, INY, DEC, DEX, DEY)
    - [x] Shifts (ASL, LSR, ROL, ROR)
    - [x] Jumps and calls (JMP, JSR, RTS)
    - [x] Branches (BCC, BCS, BEQ, BMI, BNE, BPL, BVC, BVS)
    - [x] Status flag changes (CLC, CLD, CLI, CLV, SEC, SED, SEI)
    - [x] System functions (NOP)
  - [x] Add cycle counting for accurate timing

- [x] Fix JSR and RTS implementation
  - [x] Fix JSR to push PC-1 onto the stack
  - [x] Fix RTS to add 2 to the value pulled from the stack

- [x] Improve test coverage
  - [x] Add tests for logical operations in all addressing modes
  - [x] Add tests for shift and rotate operations in memory
  - [x] Add tests for compare operations in all addressing modes
  - [x] Add tests for different edge cases

- [x] Implement disassembler
  - [x] Support for all 6502 addressing modes
  - [x] Handle all supported instructions
  - [x] Format branch targets as addresses
  - [x] Good test coverage

- [x] Missing instructions to implement:
  - [x] System functions:
    - [x] BRK ($00) - Force interrupt (pushes PC+2 and status to the stack)
    - [x] RTI ($40) - Return from interrupt (pulls status and PC from stack)

- [x] Refactor test suite
  - [x] Split the large test file into multiple smaller files
  - [x] Create shared utilities for test functions
  - [x] Organize tests by instruction type
  - [x] Improve test coverage to over 95%
  - [x] Push test coverage to 100% (achieved!)

- [x] Fix branch instruction tests
  - [x] Correct PC calculation for branch instructions
  - [x] Update expected values in tests
  - [x] Ensure all branch tests correctly verify CPU behavior
  - [x] Achieve high test coverage (98.61% functions, 99.19% lines)

- [ ] Refactor to use CPU interface
  - [x] Make CPU implementations (cpu1.ts, cpu2.ts) implement the interface
  - [x] Update ldy-completion.test.ts to use CPU interface
  - [ ] Migrate test files using direct state access to use CPU interface
    - [x] Update utils.ts to support the CPU interface
    - [ ] Convert tests using step6502 to use CPU interface methods
      - [x] system-instructions.test.ts
      - [x] edge-cases.test.ts
      - [x] missing-opcodes.test.ts
      - [x] final-extreme-edge-cases.test.ts
      - [x] final-ror-test.test.ts
      - [x] all-shift-ops.test.ts
      - [x] shift-edge-cases.test.ts
      - [x] extreme-edge-cases.test.ts
      - [x] absolute-indexed-instructions.test.ts
      - [x] final-coverage.test.ts
      - [x] achieve-100-percent.test.ts
      - [x] final-100-percent.test.ts
      - [x] ldx-absolute-y.test.ts
      - [x] remaining-coverage-branches.test.ts
      - [x] zero-page-wrap.test.ts
      - [x] memory-helpers-100-percent.test.ts
      - [x] trace-functionality.test.ts
      - [x] ldy-maximum-coverage.test.ts
      - [x] ldy-immediate.test.ts
      - [x] ldy-complete.test.ts
      - [x] instruction-cycle-coverage.test.ts
      - [x] branch-ultimate.test.ts
      - [x] branch-max-coverage.test.ts
      - [x] bit-instruction.test.ts
      - [x] store-instructions.test.ts
      - [x] status-flags.test.ts
      - [x] stack-operations.test.ts
      - [ ] shift-rotate.test.ts
      - [ ] register-transfer.test.ts
      - [ ] memory-helpers.test.ts
      - [ ] logical.test.ts
      - [ ] load-instructions.test.ts
      - [x] ldy-addressing.test.ts
      - [ ] jump-subroutine.test.ts
      - [ ] internal-helpers.test.ts
      - [ ] indirect-addressing.test.ts
      - [ ] inc-dec.test.ts
      - [ ] inc-dec-all-modes.test.ts
      - [ ] full-coverage.test.ts
      - [ ] branch.test.ts
      - [ ] branch-comprehensive.test.ts
      - [ ] arithmetic.test.ts
      - [x] addressing-modes.test.ts
      - [x] adc-sbc-addressing.test.ts

- [ ] Potential future improvements:
  - [ ] Add more examples of running simple 6502 programs
  - [x] Improve debugging with memory dump and trace functionality
  - [ ] Add a memory visualization feature
  - [ ] Consider implementing decimal mode for ADC and SBC
